name: Auto NIC packager

# On every push
on:
  push:
    branches: [ master ]
    paths:
      - "template/*"

jobs:
  packager:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      env:
        VERSION: ""
    - name: Install Theoss
      run: |
        sudo apt-get install fakeroot git perl clang-6.0 build-essential -y
        echo "export THEOS=~/theos" >> ~/.profile
        source ~/.profile
        git clone --recursive https://github.com/theos/theos.git $THEOS
        
        curl https://kabiroberai.com/toolchain/download.php?toolchain=ios-linux -Lo toolchain.tar.gz
        tar xzf toolchain.tar.gz -C $THEOS/toolchain
        rm toolchain.tar.gz
        
        curl -LO https://github.com/theos/sdks/archive/master.zip
        TMP=$(mktemp -d)
        unzip master.zip -d $TMP
        mv $TMP/sdks-master/*.sdk $THEOS/sdks
        rm -r master.zip $TMP
    
    - name: Make NIC package
      run: |
        source ~/.profile
        rm ./iOS-Mod-Menu-Template-for-Theos.nic.tar || true # To force it to not fail even if the file does not exist
        $THEOS/bin/nicify.pl ./template
        
    - name: Upload artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: "Ted2's Mod Menu Template.nic.tar"
        path: "./Ted2's Mod Menu Template.nic.tar"
      
    
  
